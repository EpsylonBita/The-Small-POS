# The Small POS (Tauri) - Release and Distribution

## Scope

This document defines the release contract for the native-only desktop app in `pos-tauri/`.

## Current Release Baseline (2026-02-23)

- Desktop source of truth: `pos-tauri/`
- Public distribution repo: `EpsylonBita/The-Small-POS`
- Active workflow: `.github/workflows/pos-tauri-auto-release.yml`
- Runtime model: Tauri-native only (no Electron desktop fallback in `pos-tauri`)

## Required Secrets (GitHub Actions)

- `POS_RELEASE_TOKEN`: PAT with push/release permissions on `EpsylonBita/The-Small-POS`
- `TAURI_SIGNING_PRIVATE_KEY`: minisign private key for updater signing
- `TAURI_SIGNING_PRIVATE_KEY_PASSWORD`: private key password (if key is protected)
- `TAURI_UPDATER_PUBKEY`: updater public key embedded into `tauri.conf.json` during CI

## Version Synchronization Contract

Version must match across:

- `pos-tauri/package.json`
- `pos-tauri/src-tauri/Cargo.toml`
- `pos-tauri/src-tauri/tauri.conf.json`

Release automation must fail on mismatch.

## Release Artifacts

Each release in `EpsylonBita/The-Small-POS` must publish:

- `The Small POS_<version>_x64-setup.exe`
- `The Small POS_<version>_x64-setup.exe.sig`
- `latest.json`

Updater endpoint used by app runtime:

- `https://github.com/EpsylonBita/The-Small-POS/releases/latest/download/latest.json`

## `latest.json` Contract

Generated by `scripts/generate-updater-manifest.mjs`.

Required shape:

```json
{
  "version": "1.2.3",
  "notes": "Release v1.2.3",
  "pub_date": "2026-02-23T00:00:00.000Z",
  "platforms": {
    "windows-x86_64": {
      "signature": "<minisign signature>",
      "url": "https://github.com/EpsylonBita/The-Small-POS/releases/download/v1.2.3/The Small POS_1.2.3_x64-setup.exe"
    }
  }
}
```

## CI Release Flow

When `pos-tauri/**` changes on release branch policy:

1. Validate version sync.
2. Inject updater public key into `src-tauri/tauri.conf.json`.
3. Build signed Windows NSIS installer.
4. Validate icon parity policy.
5. Generate `latest.json`.
6. Sync `pos-tauri/` source to public distribution repo root.
7. Create or replace release tag `v<version>`.
8. Upload `.exe`, `.sig`, and `latest.json` as latest release artifacts.

## Local Release Verification

From `pos-tauri/`:

```bash
npm ci
npm run type-check
npm run build
npm run parity:contract
npm run test:native-runtime
cargo check --keep-going --manifest-path src-tauri/Cargo.toml
npm run pos:tauri:bundle:win
```

Optional full Windows verification script:

```bash
npm run pos:tauri:verify:win
```

## Manual Manifest Generation Example

```bash
node scripts/generate-updater-manifest.mjs \
  --version 1.2.3 \
  --releaseTag v1.2.3 \
  --repoOwner EpsylonBita \
  --repoName The-Small-POS \
  --assetFileName "The Small POS_1.2.3_x64-setup.exe" \
  --signatureFilePath "src-tauri/target/release/bundle/nsis/The Small POS_1.2.3_x64-setup.exe.sig" \
  --outputPath "src-tauri/target/release/bundle/nsis/latest.json"
```

## Rollback and Hotfix Guidance

- If updater delivery fails but installer is valid, distribute installer directly and keep runtime on the newest stable.
- If a specific version is non-startable, manually install the next hotfix version once; updater flow should resume afterward.
- Keep rollback decisions aligned with backend API compatibility and data migration safety.

## Icon Identity Policy

Desktop icon identity must remain aligned with canonical branding assets:

- `branding/pos-desktop/icon.ico` == `pos-tauri/src-tauri/icons/icon.ico`
- `branding/pos-desktop/icon.png` == Tauri PNG variants

CI checks enforce this policy.

## References

- `README.md`
- `ARCHITECTURE.md`
- `SUPPORT.md`
- `docs/security-native-migration/EXECUTION_BACKLOG.md`


